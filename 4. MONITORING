D. Menerapkan Sistem Monitoring (Server 2)

1. Pembaruan dan Peningkatan Sistem
Langkah pertama dalam mengkonfigurasi server monitoring adalah memastikan bahwa sistem operasi yang digunakan up-to-date dengan menginstal pembaruan terbaru.

   sudo apt update
   sudo apt upgrade -y

2. Instalasi Prometheus
Prometheus adalah perangkat lunak open-source yang digunakan untuk monitoring dan alerting. Langkah-langkah berikut menjelaskan instalasi Prometheus pada server.

  2.1. Membuat pengguna Prometheus:
       sudo useradd --system --no-create-home --shell /bin/false prometheus

  2.2. Mengunduh dan Mengekstrak Prometheus:
       wget https://github.com/prometheus/prometheus/releases/download/v2.47.1/prometheus-2.47.1.linux-amd64.tar.gz
       tar -xvf prometheus-2.47.1.linux-amd64.tar.gz
       cd prometheus-2.47.1.linux-amd64/

  2.3. Memindahkan file Prometheus dan membuat direktori yang diperlukan:
       sudo mkdir -p /data /etc/prometheus
       sudo mv prometheus promtool /usr/local/bin/
       sudo mv consoles/ console_libraries/ /etc/prometheus/
       sudo mv prometheus.yml /etc/prometheus/prometheus.yml
	   
  2.4. Mengatur kepemilikan direktori:
       sudo chown -R prometheus:prometheus /etc/prometheus/ /data/
       
  2.5. Membuat file konfigurasi systemd untuk Prometheus:
       sudo nano /etc/systemd/system/prometheus.service
       
	   * Isi file prometheus.service:
	   [Unit]
	   Description=Prometheus
	   Wants=network-online.target
	   After=network-online.target

	   StartLimitIntervalSec=500
	   StartLimitBurst=5

	   [Service]
	   User=prometheus
	   Group=prometheus
	   Type=simple
	   Restart=on-failure
	   RestartSec=5s
	   ExecStart=/usr/local/bin/prometheus \
	     --config.file=/etc/prometheus/prometheus.yml \
	     --storage.tsdb.path=/data \
	     --web.console.templates=/etc/prometheus/consoles \
	     --web.console.libraries=/etc/prometheus/console_libraries \
	     --web.listen-address=0.0.0.0:9090 \
	     --web.enable-lifecycle

	   [Install]
	   WantedBy=multi-user.target

  2.6. Mengaktifkan dan memulai layanan Prometheus:
       sudo systemctl enable prometheus
       sudo systemctl start prometheus

  2.7. Memverifikasi status Prometheus:
       sudo systemctl status prometheus

  2.8. Mengakses Prometheus:
       Buka browser dan akses Prometheus menggunakan <publicIP-server>9090.
  
3. Instalasi Node Exporter di mainServer (Server 1)
Node Exporter adalah alat untuk mengumpulkan metrik sistem dari server Linux. Berikut langkah-langkah instalasi Node Exporter di mainServer (Server 1).

  3.1. Membuat pengguna untuk Node Exporter:
       sudo useradd --system --no-create-home --shell /bin/false node_exporter

  3.2. Mengunduh dan Mengekstrak Node Exporter:
       wget https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz
       tar -xvf node_exporter-1.6.1.linux-amd64.tar.gz
       sudo mv node_exporter-1.6.1.linux-amd64/node_exporter /usr/local/bin/
       rm -rf node_exporter*

  3.3. Membuat file konfigurasi systemd untuk Node Exporter:
       sudo nano /etc/systemd/system/node_exporter.service
       
	   Isi file node_exporter.service:
	   [Unit]
	   Description=Node Exporter
	   Wants=network-online.target
	   After=network-online.target

	   StartLimitIntervalSec=500
	   StartLimitBurst=5

	   [Service]
	   User=node_exporter
	   Group=node_exporter
	   Type=simple
	   Restart=on-failure
	   RestartSec=5s
	   ExecStart=/usr/local/bin/node_exporter --collector.logind

	   [Install]
	   WantedBy=multi-user.target

  3.4. Mengaktifkan dan memulai layanan Node Exporter:
       sudo systemctl enable node_exporter
	   sudo systemctl start node_exporter

  3.5. Memverifikasi status Node Exporter:
       sudo systemctl status node_exporter

4. Instalasi Prometheus Metrics Plugin di Jenkins (Server 1)
Untuk memantau Jenkins, plugin Prometheus Metrics perlu terinstal di Jenkins. Berikut langkah-langkah untuk menginstal plugin Prometheus Metrics di Jenkins.

  4.1. Masuk ke Dashboard Jenkins
       Manage Jenkins > Plugins
	   * Available plugins
         - Prometheus metrics
	   * Klik tombol `Install`
	   * Klik tombol `Restart Jenkins when installation is complete and no jobs are running`
   
5. Instalasi Prometheus Node Exporter di kubernetesCluster (Server 3)
Helm adalah package manager untuk Kubernetes. Berikut langkah-langkah untuk menginstal Prometheus Node Exporter di Server 3 menggunakan Helm.

  5.1. Mengunduh dan menginstal Helm:
       curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
	   
  5.2. Memverifikasi versi Helm:
       helm version
	   
  5.3. Menambahkan repository Prometheus Helm:
       helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
	   
  5.4. Membuat namespace untuk Prometheus Node Exporter:
       kubectl create namespace prometheus-node-exporter
	   
  5.5. Menginstal Prometheus Node Exporter:
       helm install prometheus-node-exporter prometheus-community/prometheus-node-exporter --namespace prometheus-node-exporter

6. Konfigurasi Prometheus
Untuk mengintegrasikan semua komponen yang dimonitor, kita perlu menambahkan konfigurasi pada file prometheus.yml.

  6.1. Membuat file konfigurasi prometheus.yml:
       sudo nano /etc/prometheus/prometheus.yml
	   
	   Isi file prometheus.yml:
	   scrape_configs:
	     - job_name: "prometheus"
	       static_configs:
	         - targets: ["localhost:9090"]

	     - job_name: "node_exporter"
	       static_configs:
	         - targets: ["<mainServer-publicIP>:9100"]

	     - job_name: "jenkins"
	       metrics_path: "/prometheus"
	       static_configs:
	         - targets: ["<mainServer-publicIP>:8080"]

	     - job_name: 'kubernetesCluster'
	       metrics_path: '/metrics'
	       static_configs:
	         - targets: ["<kubernetesCluster-publicIP>:9100"]

  6.2. Memeriksa validitas file konfigurasi:
       promtool check config /etc/prometheus/prometheus.yml
	   
  6.3. Memuat ulang konfigurasi Prometheus tanpa me-restart:
       curl -X POST http://localhost:9090/-/reload
	   
  6.4. Verifikasi bahwa semua target sudah UP:
       * Buka tab Prometheus di browser dan pastikan semua target sudah UP.

7. Instalasi Grafana
Grafana adalah platform open-source untuk analitik dan monitoring. Langkah-langkah berikut menjelaskan instalasi Grafana pada server.

  7.1. Menginstal dependensi:
       sudo apt-get update
       sudo apt-get install -y apt-transport-https software-properties-common
	   
  7.2. Menambahkan GPG Key:
       wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
	   
  7.3. Menambahkan repository Grafana:
       echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
	   
  7.4. Mengupdate dan menginstal Grafana:
       sudo apt-get update
       sudo apt-get -y install grafana
	   
  7.5. Mengaktifkan dan memulai layanan Grafana:
       sudo systemctl enable grafana-server
       sudo systemctl start grafana-server
	   
  7.6. Memverifikasi status Grafana:
       sudo systemctl status grafana-server

8. Konfigurasi Grafana
Langkah-langkah berikut menjelaskan konfigurasi Grafana untuk menghubungkan dengan Prometheus dan mengimpor dashboard.

  8.1. Mengakses Grafana.
       * Buka browser dan akses Grafana menggunakan IP server dan port 3000.
	   * Login dengan kredensial default (admin/admin) dan lewati langkah update password.
	   
  8.2. Menambahkan Data Source.
       * Navigasi ke Dashboard > Data Sources.
	   * Pilih Prometheus dan masukkan URL Prometheus (http://<server-IP>:9090).
	   * Klik tombol `Save & Test`.
	   
  8.3. Mengimpor Dashboard Jenkins: Performance and Health Overview.
       * Klik tombol (+) pada pojok kanan atas, lalu pilih Import dashboard.
	   * Masukkan ID dashboard dari https://grafana.com/grafana/dashboards/ (1860) dan klik Load.
	   * Pilih Prometheus sebagai data source dan klik Import.
	   
  8.4. Mengimpor Dashboard Node Exporter Full
       * Klik tombol (+) pada pojok kanan atas, lalu pilih Import dashboard.
	   * Masukkan ID dashboard dari https://grafana.com/grafana/dashboards/ (9964) dan klik Load.
	   * Pilih Prometheus sebagai data source dan klik Import.
	   
9. Verifikasi Konfigurasi
Memverifikasi konfigurasi Prometheus dan Node Exporter pada Server 1 dan Server 3 untuk memastikan bahwa semua komponen monitoring berjalan dengan baik dan dapat mengirim serta menerima metrik yang diperlukan.

  9.1. Verifikasi status target di Prometheus
       Akses tab Prometheus di browser dan pastikan semua target sudah UP.
	   
  9.2. Verifikasi Dashboard Jenkins: Performance and Health Overview di Jenkins
       Akses tab Grafana di browser dan pastikan Dashboard Jenkins sudah terisi.
	   
  9.3. Verifikasi Dashboard Node Exporter Full
       Akses tab Grafana di browser dan pastikan Dashboard Node Exporter sudah terisi.
       